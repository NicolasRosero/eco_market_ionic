<ion-header class="ion-no-border">
  <app-header />

  <ion-toolbar class="screen-background-secondary">
    <ion-title class="text-primary">Mi Carrito ({{ totalItems }})</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="screen-background-secondary">
  <!-- Loader -->
  <div *ngIf="isLoading" class="ion-text-center ion-padding-top">
    <ion-spinner name="crescent" color="dark"></ion-spinner>
    <p class="text-dark">Cargando carrito...</p>
  </div>
  <!-- Loader -->

  <!-- Sección para ir a comprar productos -->
  <div
    class="empty-cart-message ion-text-center ion-padding-top"
    *ngIf="!isLoading && cartItems.length === 0"
  >
    <ion-icon name="cart-outline" size="large" class="text-dark"></ion-icon>
    <h2 class="text-primary">Tu carrito está vacío</h2>
    <p class="text-dark">¡Empieza a agregar productos de la lista!</p>

    <ion-button class="btn btn-primary-link ion-margin-top" (click)="goToProducts()">
      Ir a Comprar
    </ion-button>
  </div>
  <!-- End Sección para ir a comprar productos -->

  <!-- Sección de los items del carrito -->
  <ul
    class="cart-items-list ion-padding-vertical"
    *ngIf="!isLoading && cartItems.length > 0"
  >
    <li
      class="cart-item-wrapper screen-background-secondary ion-padding-vertical"
      *ngFor="let item of cartItems"
    >
      <ion-grid>
        <ion-row class="ion-align-items-center cart-item-row">
          <ion-col size="3" size-md="2" class="ion-no-padding">
            <img
              [src]="item.product.image || 'assets/images/producto_skeleton.png'"
              [alt]="item.product.name"
              class="cart-item-image"
            >
          </ion-col>

          <ion-col size="9" size-md="7">
            <div class="ion-padding-start">
              <h3 class="text-primary ion-no-margin ion-text-wrap item-name">{{ item.product.name }}</h3>
              <p class="text-secondary ion-no-margin item-unit-price">
                Precio unitario: <strong>{{ setFormatPrice(item.product.price) }}</strong>
              </p>
              <p class="text-dark ion-no-margin item-total-price">
                Total: <strong>{{ setFormatPrice(item.product.price * item.quantity) }}</strong>
              </p>

              <div class="quantity-controls ion-margin-top">
                <button
                  class="action-box action-box-small btn-dark-control"
                  [disabled]="item.quantity <= 1"
                  (click)="updateQuantity(item, -1)"
                >
                  <ion-icon name="remove-outline"></ion-icon>
                </button>

                <span class="quantity-display text-dark">{{ item.quantity }}</span>

                <button
                  class="action-box action-box-small btn-dark-control"
                  (click)="updateQuantity(item, 1)"
                >
                  <ion-icon name="add-outline"></ion-icon>
                </button>
              </div>
            </div>
          </ion-col>
        </ion-row>

        <ion-row class="ion-align-items-center ion-justify-content-end">
          <ion-col size="auto" class="ion-no-padding">
            <button
              class="btn-clear btn-danger-text btn-mobile-delete"
              (click)="deleteItem(item.product.id)"
            >
              <ion-icon name="trash-outline" slot="start"></ion-icon>
              Eliminar
            </button>
          </ion-col>
        </ion-row>
      </ion-grid>
    </li>
  </ul>
  <!-- End Sección de los items del carrito -->

  <!-- Botón flotante para limpiar el carrito -->
  <ion-fab
    slot="fixed"
    vertical="bottom"
    horizontal="end"
    *ngIf="!isLoading && cartItems.length > 0"
  >
    <ion-fab-button color="danger" (click)="clearCart()">
      <ion-icon name="trash-outline"></ion-icon>
    </ion-fab-button>
  </ion-fab>
  <!-- Botón flotante para limpiar el carrito -->
</ion-content>

<footer
  class="footer-summary ion-padding"
  *ngIf="!isLoading && cartItems.length > 0"
>
  <div class="checkout-summary-wrapper">
    <div class="checkout-summary-toolbar ion-padding-top">
      <ion-row class="ion-justify-content-between ion-align-items-center">
        <ion-col size="7">
          <h4 class="text-dark ion-no-margin">Total ({{ totalItems }} ítems):</h4>
        </ion-col>

        <ion-col size="5" class="ion-text-right">
          <h3 class="text-primary ion-no-margin"><strong>{{ setFormatPrice(totalValue) }}</strong></h3>
        </ion-col>
      </ion-row>

      <ion-button class="btn btn-block" (click)="goToCheckout()">
        Finalizar Compra
        <ion-icon name="arrow-forward-outline"></ion-icon>
      </ion-button>
    </div>
  </div>
</footer>
